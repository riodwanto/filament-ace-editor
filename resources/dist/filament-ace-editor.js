function H({state:v,statePath:T,placeholder:g,aceUrl:L,extensions:m,config:E={},options:h={},darkTheme:w,disableDarkTheme:S,completions:F=[],snippets:R=[],enableCustomCompletions:M=!1,toolbarButtons:U=[],hasToolbar:$=!1,showStatusBar:O=!1,statusBarOptions:k={},extensionLoadingConfig:P={},keyboardAccessibility:B=!1,screenReaderSupport:I=!1,ariaLabels:A={},currentFontSize:z="14px",currentWordWrap:W="off",overscrollOptions:D={},isDisabled:G=!1}){return{state:v,statePath:T,placeholder:g,options:h,darkTheme:w,disableDarkTheme:S,completions:F,snippets:R,enableCustomCompletions:M,toolbarButtons:U,hasToolbar:$,showStatusBar:O,statusBarOptions:k,isDisabled:G,editor:null,observer:null,shouldUpdateState:!0,isDestroyed:!1,isFullscreen:!1,loadedScripts:[],eventListeners:[],toolbarState:{canUndo:!1,canRedo:!1,showPrintMargin:!0,showInvisibles:!1,wordWrapEnabled:!1},statusBarElement:null,statusBarState:{position:{row:1,column:1},selection:{start:{row:1,column:1},end:{row:1,column:1}},lines:1,characters:0,mode:"text",theme:"textmate"},debounceTimers:{statusBarUpdate:null,toolbarUpdate:null},lastToolbarState:{canUndo:!1,canRedo:!1,showPrintMargin:!0,showInvisibles:!1,wordWrapEnabled:!1},lastExpensiveState:{showInvisibles:!1,lastCheckTime:0},printMarginState:{showPrintMargin:!0,printMarginColumn:80,lastUpdateTime:0,updateScheduled:!1,throttledUpdate:null},gotoLineState:{history:[],maxHistory:20,lastGotoLine:1,animationFrame:null,isAnimating:!1},undoRedoState:{canUndo:!1,canRedo:!1,lastCheckTime:0,checkCacheTimeout:50,undoDepth:null,redoDepth:null,lastOperationTime:0,operationQueue:[],isProcessingQueue:!1},caseConversionState:{lastConversionTime:0,conversionCache:new Map,maxCacheSize:100,largeTextThreshold:5e3,operationInProgress:!1},lastFoldState:{canFold:!1,canUnfold:!1,isInsideFold:!1,cursorRow:-1,cursorColumn:-1},statusBarElements:{line:null,column:null,selection:null,mode:null,length:null},operationState:{currentOperation:null,operationQueue:[],batchTimeout:null,batchDelay:16,isBatching:!1,renderChanges:0,lastRenderTime:0,pendingChanges:{cursor:!1,selection:!1,text:!1,scroll:!1,gutter:!1}},extensionLoadingConfig:P,keyboardAccessibility:B,screenReaderSupport:I,ariaLabels:A,currentFontSize:z,currentWordWrap:W,overscrollOptions:D,async init(){if(this.$root.closest(".fi-modal")&&await new Promise(e=>setTimeout(e,300)),this.editor){try{this.editor.destroy()}catch(e){console.warn("Error cleaning up existing editor instance:",e)}this.editor=null}await this.initializeEditor(),this.addGlobalFullscreenEscapeHandler()},destroy(){if(!this.isDestroyed){this.isDestroyed=!0;try{this.editor&&(this.editor.session&&this.editor.session.removeAllListeners(),this.editor.selection&&this.editor.selection.removeAllListeners(),this.editor.destroy(),this.editor=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.destroyStatusBar(),this.isFullscreen&&this.toggleFullscreen(),this._globalEscapeHandler&&(document.removeEventListener("keydown",this._globalEscapeHandler,!0),this._globalEscapeHandler=null),this.cleanupLoadedScripts(),Object.values(this.debounceTimers).forEach(e=>{e&&clearTimeout(e)}),this.eventListeners=[],this.loadedScripts=[],this.statusBarElements={},this.printMarginState.throttledUpdate&&(cancelAnimationFrame(this.printMarginState.throttledUpdate),this.printMarginState.throttledUpdate=null),this.gotoLineState.animationFrame&&(cancelAnimationFrame(this.gotoLineState.animationFrame),this.gotoLineState.animationFrame=null),this.undoRedoState.operationQueue=[],this.undoRedoState.isProcessingQueue=!1,this.caseConversionState.conversionCache.clear(),this.caseConversionState.operationInProgress=!1,this.operationState.batchTimeout&&(clearTimeout(this.operationState.batchTimeout),this.operationState.batchTimeout=null),this.operationState.operationQueue=[],this.operationState.isBatching=!1}catch(e){console.error("Error during ACE editor cleanup:",e)}}},cleanupLoadedScripts(){this.loadedScripts.forEach(e=>{document.querySelectorAll(`script[src="${e}"]`).forEach(o=>{o.parentNode&&o.parentNode.removeChild(o)})}),this.loadedScripts=[]},async initializeEditor(){try{await this.loadScript(L),await this.loadExtensionsEnhanced(),console.log("Extension Loading Statistics:",this.getExtensionLoadingStats()),Object.entries(E).forEach(([t,o])=>{ace.config.set(t,o)}),this.editor=ace.edit(this.$refs.aceCodeEditorInner);let e={animatedScroll:!1,showPrintMargin:!0,fadeFoldWidgets:!1,displayIndentGuides:!1,highlightGutterLine:!1,showInvisibles:!1,...h,fontSize:this.currentFontSize,showGutter:h.showGutter!==!1,showLineNumbers:h.showLineNumbers!==!1};e.cursorStyle&&console.log("\u{1F3AF} Applying cursorStyle:",e.cursorStyle),console.log("\u{1F4DD} Full merged options:",e),this.editor.setOptions(e),e.cursorStyle&&setTimeout(()=>{let t=this.editor.getOption("cursorStyle");console.log("\u2705 CursorStyle verification - applied:",t,"expected:",e.cursorStyle),t!==e.cursorStyle&&(console.warn("\u26A0\uFE0F CursorStyle mismatch! Trying direct setOption..."),this.editor.setOption("cursorStyle",e.cursorStyle))},100),this.changeWordWrap(this.currentWordWrap),this.applyOverscrollSettings(),this.editor.session.setValue(this.state||g),this.applyInitialTheme(),this.observeDarkModeChanges(),this.setupPerformanceOptimizations(),this.setupReliabilityImprovements(),this.$watch("state",Alpine.debounce(()=>{if(!(this.isDestroyed||!this.editor)){if(!this.shouldUpdateState){this.shouldUpdateState=!0;return}this.editor.isFocused()||this.editor.session.setValue(this.state||g)}},100)),this.editor.session.on("change",Alpine.debounce(()=>{if(this.isDestroyed||!this.editor)return;let t=this.editor.getValue();this.state=t,this.shouldUpdateState=!1,this.updateToolbarState(!1)},150)),this.enableCustomCompletions&&this.setupCustomCompletions(),this.initToolbar(),this.initializeExpensiveStateCache(),this.optimizeUndoManager(),setTimeout(()=>{this.updateToolbarState()},50),this.showStatusBar&&this.initStatusBar(),this.initAccessibility()}catch(e){console.error("ACE Editor initialization failed:",e),this.handleInitializationError(e)}},handleInitializationError(e){console.error("ACE Editor initialization failed, falling back to basic textarea:",e);let t=this.$refs?.aceCodeEditorInner;t&&(t.innerHTML=`
                    <div class="fi-ace-editor-fallback">
                        <div class="fi-ace-editor-error-banner">
                            <div class="flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                                <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                                <div>
                                    <p class="text-sm font-medium text-yellow-800">Code editor loaded in basic mode</p>
                                    <p class="text-xs text-yellow-600">Advanced features are temporarily unavailable</p>
                                </div>
                            </div>
                        </div>
                        <textarea
                            x-model="state"
                            placeholder="${this.placeholder}"
                            class="fi-input w-full min-h-[200px] font-mono text-sm"
                            rows="15"
                            ${this.isDisabled?"disabled":""}
                        ></textarea>
                        <details class="mt-2 text-xs text-gray-500">
                            <summary class="cursor-pointer hover:text-gray-700">Technical Details</summary>
                            <pre class="mt-1 p-2 bg-gray-50 rounded text-xs overflow-auto">${e.message||"Unknown error occurred"}</pre>
                        </details>
                    </div>
                `),this.isFallbackMode=!0,this.editor=null},async loadScriptWithRetry(e,t=null,o=null){t=t||this.extensionLoadingConfig.maxRetries||3,o=o||this.extensionLoadingConfig.retryDelay||1e3;for(let s=1;s<=t;s++)try{await this.loadScript(e);return}catch(i){if(console.warn(`Attempt ${s} failed to load script: ${e}`,i),s===t)throw new Error(`Failed to load script after ${t} attempts: ${e}`);await new Promise(n=>setTimeout(n,o))}},async loadExtensionsEnhanced(){if(!m||Object.keys(m).length===0){console.log("No extensions to load");return}let e=Object.entries(m),t=this.extensionLoadingConfig.parallelLoading!==!1,o=this.extensionLoadingConfig.maxRetries||3,s=this.extensionLoadingConfig.timeout||3e4;console.log(`Loading ${e.length} extensions (parallel: ${t}, maxRetries: ${o}, timeout: ${s}ms)`);let i=e.map(async([r,d])=>{try{return console.log(`Loading extension: ${r} from ${d}`),await this.loadScriptWithRetry(d,o),console.log(`Successfully loaded extension: ${r}`),{name:r,url:d,status:"loaded"}}catch(p){return console.error(`Failed to load extension: ${r}`,p),{name:r,url:d,status:"failed",error:p}}}),n;if(t)n=await Promise.allSettled(i);else{n=[];for(let r of i){let d=await Promise.allSettled([r]);n.push(d[0])}}let a=n.filter(r=>r.value?.status==="loaded").map(r=>r.value.name),l=n.filter(r=>r.value?.status==="failed").map(r=>r.value);return a.length>0&&console.log(`Successfully loaded extensions: ${a.join(", ")}`),l.length>0&&(console.error(`Failed to load extensions: ${l.map(r=>r.name).join(", ")}`),l.forEach(r=>{console.error(`Extension ${r.name} error:`,r.error)})),a},getExtensionLoadingStats(){let e=Object.entries(m||{}),t=e.length,o=e.map(([i,n])=>n),s=this.loadedScripts.filter(i=>o.some(n=>i.includes(n.split("/").pop()))).length;return{total:t,loaded:s,pending:Math.max(0,t-s),successRate:t>0?Math.min(100,s/t*100).toFixed(1):0}},loadScript(e){return new Promise((t,o)=>{if(this.loadedScripts.includes(e)){t();return}let s=document.createElement("script");s.src=e,s.onload=()=>{this.loadedScripts.push(e),t()},s.onerror=o,document.head.appendChild(s)})},applyInitialTheme(){S?this.editor&&this.editor.setTheme(h.theme):this.setTheme()},observeDarkModeChanges(){if(S)return;let e=document.querySelector("html");this.observer=new MutationObserver(()=>this.setTheme()),this.observer.observe(e,{attributes:!0,attributeFilter:["class"]})},setTheme(){if(!this.editor)return;let t=document.querySelector("html").classList.contains("dark")&&w||h.theme;this.editor.setTheme(t)},setupCustomCompletions(){if(!this.editor)return;this.editor.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0});let e=ace.require("ace/ext/language_tools");if(this.completions&&this.completions.length>0){let t=this,o={getCompletions:function(s,i,n,a,l){let r=[];t.completions.forEach(d=>{r.push({caption:d.caption,value:d.value,meta:d.meta||"Custom",score:d.score||1e3})}),l(null,r)}};e.addCompleter(o)}this.snippets&&this.snippets.length>0&&Object.keys(this.snippets).forEach(t=>{let o=this.snippets[t];e.addSnippet({name:t,trigger:t,content:o})})},executeToolbarAction(e,t){if(!this.editor||!this.hasToolbar)return;t&&(t.preventDefault(),t.stopPropagation());let s={undo:()=>this.performOptimizedUndo(),redo:()=>this.performOptimizedRedo(),find:()=>this.editor.execCommand("find"),replace:()=>this.editor.execCommand("replace"),"goto-line":()=>this.goToLine(),"toggle-comment":()=>this.toggleCommentLines(),"toggle-fold":()=>this.toggleCurrentFold(),"show-invisibles":()=>this.toggleShowInvisibles(),"toggle-wordwrap":()=>this.toggleWordWrap(),"convert-uppercase":()=>this.convertToUpperCase(),"convert-lowercase":()=>this.convertToLowerCase(),"toggle-print-margin":()=>this.togglePrintMargin()}[e];s&&(s(),this.updateToolbarState())},toggleCurrentFold(){let e=this.editor.getSession(),t=this.editor.getCursorPosition(),o=this.getEfficientFoldState();try{if(o.isInsideFold){let i=e.getFoldAt(t.row,t.column,1);if(i)e.unfold(i);else if(e.isRowFolded(t.row)){let n=e.getFoldWidgetRange(t.row,"all");n&&e.unfold(n)}return}let s=e.getFoldWidget(t.row);if(s==="start"){let i=e.getFoldWidgetRange(t.row,"all");i&&(e.isRowFolded(t.row)?e.unfold(i):e.addFold("...",i))}else if(s==="end"){let i=e.getFoldWidgetRange(t.row,"all");i&&e.unfold(i)}else{let i=t.row-1,n=10;for(;i>=0&&n>0;){if(e.getFoldWidget(i)==="start"){let l=e.getFoldWidgetRange(i,"all");if(l){e.isRowFolded(i)?e.unfold(l):e.addFold("...",l);break}}i--,n--}}this.lastFoldState.cursorRow=-1,this.lastFoldState.cursorColumn=-1}catch(s){console.error("Error toggling fold:",s);try{this.editor.execCommand("toggleFoldWidget"),this.lastFoldState.cursorRow=-1,this.lastFoldState.cursorColumn=-1}catch(i){console.error("Fallback fold command failed:",i)}}},toggleCommentLines(){let e=this.editor,t=e.getSession(),o=e.getSelection(),s=o.getRange();if(s.isEmpty()){let i=o.getCursor().row;this.toggleLineComment(t,i,i)}else this.toggleLineComment(t,s.start.row,s.end.row)},toggleLineComment(e,t,o){let s=this.getCommentPrefix(e);if(!s)return;let i=s.prefix,n=s.suffix||"",a=!0;for(let l=t;l<=o;l++){let r=e.getLine(l);if(r.trim()&&!r.trim().startsWith(i)){a=!1;break}}for(let l=t;l<=o;l++){let r=e.getLine(l);if(a){let d=r;n?d=r.replace(new RegExp(`^\\s*${i}\\s*(.*?)\\s*${n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s?$`),"$1"):d=r.replace(new RegExp(`^\\s*${i}\\s?`),""),e.replace({start:{row:l,column:0},end:{row:l,column:r.length}},d)}else{let d;n?d=i+" "+r+" "+n:d=i+" "+r,e.replace({start:{row:l,column:0},end:{row:l,column:r.length}},d)}}},getCommentPrefix(e){let t=e.getMode().$id;return{"ace/mode/php":{prefix:"//",suffix:""},"ace/mode/javascript":{prefix:"//",suffix:""},"ace/mode/typescript":{prefix:"//",suffix:""},"ace/mode/java":{prefix:"//",suffix:""},"ace/mode/c_cpp":{prefix:"//",suffix:""},"ace/mode/csharp":{prefix:"//",suffix:""},"ace/mode/python":{prefix:"#",suffix:""},"ace/mode/ruby":{prefix:"#",suffix:""},"ace/mode/perl":{prefix:"#",suffix:""},"ace/mode/sh":{prefix:"#",suffix:""},"ace/mode/bash":{prefix:"#",suffix:""},"ace/mode/sql":{prefix:"--",suffix:""},"ace/mode/html":{prefix:"<!--",suffix:"-->"},"ace/mode/xml":{prefix:"<!--",suffix:"-->"},"ace/mode/css":{prefix:"/*",suffix:"*/"},"ace/mode/scss":{prefix:"//",suffix:""},"ace/mode/sass":{prefix:"//",suffix:""},"ace/mode/less":{prefix:"//",suffix:""}}[t]||{prefix:"//",suffix:""}},toggleShowInvisibles(e="all"){let t=this.editor.getShowInvisibles(),o;switch(e){case"all":o=!t;break;case"spaces":o=t==="spaces"?!1:"spaces";break;case"tabs":o=t==="tabs"?!1:"tabs";break;case"eol":o=t==="eol"?!1:"eol";break;default:o=!t}this.editor.setShowInvisibles(o),this.lastExpensiveState.showInvisibles=o,this.lastExpensiveState.lastCheckTime=Date.now(),this.updateToolbarState(!0)},toggleWordWrap(){let e=this.editor.getSession(),t=e.getUseWrapMode();e.setUseWrapMode(!t),this.updateToolbarState()},convertToUpperCase(){this.convertCaseOptimized("toUpperCase")},convertToLowerCase(){this.convertCaseOptimized("toLowerCase")},convertCaseOptimized(e){let t=performance.now(),o=this.caseConversionState;if(!o.operationInProgress){o.operationInProgress=!0;try{let s=this.editor.getSession(),i=this.editor.getSelectionRange();this.editor.getSelection().isEmpty()&&this.editor.getSelection().selectWord();let n=this.editor.getSelectionRange(),a=s.getTextRange(n);if(!a||a.length===0){this.editor.getSelection().setSelectionRange(i);return}let l=`${a}:${e}`;if(o.conversionCache.has(l)){let r=o.conversionCache.get(l);s.replace(n,r),this.editor.getSelection().setSelectionRange(i);return}if(a.length>o.largeTextThreshold)this.performLargeTextConversion(n,a,e,i,l);else{let r=e==="toUpperCase"?a.toUpperCase():a.toLowerCase();this.performOptimizedReplacement(n,r,i,l)}}catch(s){console.warn(`Case conversion failed (${e}):`,s),this.editor.execCommand(e.toLowerCase())}finally{o.operationInProgress=!1,o.lastConversionTime=performance.now()}}},performLargeTextConversion(e,t,o,s,i){requestAnimationFrame(()=>{try{let n=o==="toUpperCase"?t.toUpperCase():t.toLowerCase();this.performOptimizedReplacement(e,n,s,i)}catch(n){console.warn("Large text conversion failed:",n),this.editor.execCommand(o.toLowerCase())}})},performOptimizedReplacement(e,t,o,s){let i=this.editor.getSession(),n=i.getOption("mergeUndoDeltas");i.setOption("mergeUndoDeltas","always");try{i.replace(e,t),this.editor.getSelection().setSelectionRange(o),this.cacheConversionResult(s,t)}finally{i.setOption("mergeUndoDeltas",n)}},cacheConversionResult(e,t){let o=this.caseConversionState;if(o.conversionCache.size>=o.maxCacheSize){let s=o.conversionCache.keys().next().value;o.conversionCache.delete(s)}o.conversionCache.set(e,t)},togglePrintMargin(){let t=!this.printMarginState.showPrintMargin;this.setPrintMarginOptimized(t),this.updateToolbarState(!0)},setPrintMarginOptimized(e){if(this.printMarginState.showPrintMargin===e)return;let t=performance.now();this.printMarginState.showPrintMargin=e,this.printMarginState.lastUpdateTime=t,this.printMarginState.throttledUpdate&&cancelAnimationFrame(this.printMarginState.throttledUpdate),this.printMarginState.throttledUpdate=requestAnimationFrame(()=>{try{this.editor.setShowPrintMargin(e),this.updateWordWrapForPrintMargin()}catch(o){console.warn("Print margin update failed:",o),this.editor.setShowPrintMargin(e)}finally{this.printMarginState.throttledUpdate=null,this.printMarginState.updateScheduled=!1}}),this.printMarginState.updateScheduled=!0},updateWordWrapForPrintMargin(){try{let e=this.editor.getSession();if(e&&e.getUseWrapMode()){let t=this.editor.renderer;t&&t.adjustWrapLimit&&t.adjustWrapLimit()}}catch{}},setPrintMarginColumn(e){e=Math.max(1,Math.min(e,1e3)),this.printMarginState.printMarginColumn!==e&&(this.printMarginState.printMarginColumn=e,this.printMarginState.throttledUpdate&&cancelAnimationFrame(this.printMarginState.throttledUpdate),this.printMarginState.throttledUpdate=requestAnimationFrame(()=>{try{this.editor.setPrintMarginColumn(e),this.updateWordWrapForPrintMargin()}catch(t){console.warn("Print margin column update failed:",t)}finally{this.printMarginState.throttledUpdate=null}}))},goToLine(){this.editor&&this.showOptimizedGotoLineDialog()},showOptimizedGotoLineDialog(){let e=this.editor.getSession(),t=this.editor.getCursorPosition().row+1,o=e.getLength(),s=document.documentElement.classList.contains("dark"),i=this.editor.container,n=this.createOptimizedModal(s),a=this.createGotoLineDialog(t,o,s);n.appendChild(a),i.appendChild(n),this.setupGotoLineHandlers(n,a,t,o,s),requestAnimationFrame(()=>{let l=a.querySelector("#gotoLineInput");l&&(l.focus(),l.select())})},createOptimizedModal(e){let t=document.createElement("div");return t.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.3);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                backdrop-filter: blur(2px);
                transition: opacity 0.15s ease-out;
            `,t.style.opacity="0",requestAnimationFrame(()=>{t.style.opacity="1"}),t},createGotoLineDialog(e,t,o){let s=document.createElement("div");s.style.cssText=`
                background: ${o?"#1f2937":"white"};
                color: ${o?"white":"black"};
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                min-width: 320px;
                max-width: 360px;
                border: 1px solid ${o?"#374151":"#e5e7eb"};
                transform: scale(0.95);
                opacity: 0;
                transition: all 0.15s ease-out;
            `;let i=this.gotoLineState.history.length>0?`<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid ${o?"#374151":"#e5e7eb"};">
                    <div style="font-size: 11px; color: ${o?"#9ca3af":"#666"}; margin-bottom: 6px;">Recent:</div>
                    <div id="gotoHistory" style="display: flex; flex-wrap: wrap; gap: 4px;">
                        ${this.gotoLineState.history.slice(-5).map(n=>`<button class="history-btn" data-line="${n}" style="padding: 2px 8px; font-size: 11px; background: ${o?"#374151":"#f3f4f6"}; color: ${o?"#d1d5db":"#4b5563"}; border: 1px solid ${o?"#4b5563":"#d1d5db"}; border-radius: 3px; cursor: pointer; font-family: monospace;">${n}</button>`).join("")}
                    </div>
                </div>`:"";return s.innerHTML=`
                <div style="margin-bottom: 16px;">
                    <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: ${o?"white":"#111827"};">Go to Line</h3>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <label style="font-size: 13px; font-weight: 500; white-space: nowrap; color: ${o?"#d1d5db":"#374151"};">Line:</label>
                        <input type="text"
                               id="gotoLineInput"
                               inputmode="numeric"
                               pattern="[0-9]*"
                               value="${e}"
                               style="flex: 1; padding: 6px 10px; border: 2px solid ${o?"#4b5563":"#d1d5db"}; background: ${o?"#374151":"white"}; color: ${o?"white":"black"}; border-radius: 4px; font-size: 14px; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace; min-width: 80px; outline: none; transition: border-color 0.15s ease;"
                               placeholder="1"
                               autocomplete="off">
                        <span style="font-size: 12px; color: ${o?"#9ca3af":"#6b7280"};">of ${t}</span>
                    </div>
                    <div id="inputFeedback" style="font-size: 11px; color: ${o?"#f87171":"#dc2626"}; min-height: 16px; opacity: 0; transition: opacity 0.15s ease;">Invalid line number</div>
                </div>
                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button id="gotoLineCancel"
                            style="padding: 6px 14px; border: 1px solid ${o?"#4b5563":"#d1d5db"}; background: ${o?"#374151":"white"}; color: ${o?"white":"black"}; border-radius: 4px; cursor: pointer; font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; transition: all 0.15s ease;">
                        Cancel
                    </button>
                    <button id="gotoLineGo"
                            style="padding: 6px 14px; border: 1px solid #2563eb; background: #2563eb; color: white; border-radius: 4px; cursor: pointer; font-size: 13px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; transition: all 0.15s ease; font-weight: 500;">
                        Go to Line
                    </button>
                </div>
                ${i}
            `,requestAnimationFrame(()=>{s.style.transform="scale(1)",s.style.opacity="1"}),s},setupGotoLineHandlers(e,t,o,s,i){let n=t.querySelector("#gotoLineInput"),a=t.querySelector("#gotoLineGo"),l=t.querySelector("#gotoLineCancel"),r=t.querySelector("#inputFeedback"),d=t.querySelectorAll(".history-btn"),p=()=>{let c=n.value.trim(),u=this.parseGotoLineInput(c);u.isValid?(this.addToGotoHistory(u.line),this.performOptimizedGotoLine(u.line,u.column,!0),this.editor.focus(),y()):q(u.error)},q=c=>{r.textContent=c,r.style.opacity="1",n.style.borderColor=i?"#f87171":"#dc2626",setTimeout(()=>{r.style.opacity="0",n.style.borderColor=i?"#4b5563":"#d1d5db"},2e3)},y=()=>{t.style.transform="scale(0.95)",t.style.opacity="0",e.style.opacity="0",setTimeout(()=>{this.cleanupGotoLineDialog(e),this.editor.focus()},150)},f=()=>{y()},b,C=()=>{clearTimeout(b),b=setTimeout(()=>{let c=this.parseGotoLineInput(n.value.trim());a.style.opacity=c.isValid?"1":"0.6",a.disabled=!c.isValid,c.isValid?(n.style.borderColor=i?"#10b981":"#059669",r.style.opacity="0"):n.value.trim()&&(n.style.borderColor=i?"#4b5563":"#d1d5db",r.style.opacity="0")},150)};n.addEventListener("input",C),n.addEventListener("keydown",c=>{if(c.key==="Enter")return c.preventDefault(),c.stopPropagation(),p(),!1;if(c.key==="Escape")return c.preventDefault(),c.stopPropagation(),f(),!1}),d.forEach(c=>{c.addEventListener("click",()=>{let u=c.dataset.line;n.value=u,C(),n.focus()})}),a.addEventListener("click",p),l.addEventListener("click",f),e.addEventListener("click",c=>{c.target===e&&f()});let x=c=>{if((c.key==="Enter"||c.key==="Escape")&&e.parentNode)return c.preventDefault(),c.stopPropagation(),c.key==="Enter"?p():f(),!1};document.addEventListener("keydown",x,!0),e._cleanup=()=>{document.removeEventListener("keydown",x,!0),clearTimeout(b)}},parseGotoLineInput(e){let o=this.editor.getSession().getLength();if(!e)return{isValid:!1,error:"Please enter a line number"};let s,i=0,n=e.match(/^(\d+)([:>])(\d*)$/);if(n)s=parseInt(n[1],10),n[3]&&(i=parseInt(n[3],10));else if(e.toLowerCase().startsWith("c")){let a=parseInt(e.slice(1),10);return{isValid:!0,line:Math.max(1,Math.floor(a/80)),column:0}}else s=parseInt(e,10);return isNaN(s)||s<1||s>o?{isValid:!1,error:`Line must be between 1 and ${o}`}:((isNaN(i)||i<0)&&(i=0),{isValid:!0,line:s,column:i})},performOptimizedGotoLine(e,t,o=!0){try{this.gotoLineState.animationFrame&&cancelAnimationFrame(this.gotoLineState.animationFrame),this.gotoLineState.animationFrame=requestAnimationFrame(()=>{this.editor.clearSelection(),this.editor.getSession().unfold({row:e-1,column:t||0}),this.editor.moveCursorTo(e-1,t||0),this.editor.isRowFullyVisible(e-1)||this.editor.scrollToLine(e-1,!0,o),this.gotoLineState.lastGotoLine=e,this.gotoLineState.animationFrame=null})}catch(s){console.warn("Goto line operation failed:",s),this.editor.gotoLine(e,t,o)}},addToGotoHistory(e){let t=this.gotoLineState.history.indexOf(e);t>-1&&this.gotoLineState.history.splice(t,1),this.gotoLineState.history.push(e),this.gotoLineState.history.length>this.gotoLineState.maxHistory&&this.gotoLineState.history.shift()},cleanupGotoLineDialog(e){e.parentNode&&e.parentNode.removeChild(e),e._cleanup&&(e._cleanup(),e._cleanup=null),this.gotoLineState.animationFrame&&(cancelAnimationFrame(this.gotoLineState.animationFrame),this.gotoLineState.animationFrame=null)},toggleFullscreen(){this.isFullscreen=!this.isFullscreen;let e=this.$el.closest(".rd-ace-editor");this.isFullscreen?(e.classList.add("rd-ace-editor--fullscreen"),document.body.style.overflow="hidden"):(e.classList.remove("rd-ace-editor--fullscreen"),document.body.style.overflow=""),setTimeout(()=>{this.editor&&!this.isDestroyed&&(this.editor.resize(),this.isFullscreen&&this.editor.renderer.updateFull())},100)},initializeExpensiveStateCache(){if(this.editor)try{this.lastExpensiveState.showInvisibles=this.editor.getShowInvisibles(),this.lastExpensiveState.lastCheckTime=Date.now(),this.printMarginState.showPrintMargin=this.editor.getShowPrintMargin(),this.printMarginState.printMarginColumn=this.editor.getPrintMarginColumn()||80,this.printMarginState.lastUpdateTime=Date.now();let e=this.editor.session.getUndoManager();this.lastToolbarState.canUndo=e.hasUndo(),this.lastToolbarState.canRedo=e.hasRedo(),this.undoRedoState.canUndo=this.lastToolbarState.canUndo,this.undoRedoState.canRedo=this.lastToolbarState.canRedo,this.undoRedoState.lastCheckTime=Date.now(),this.lastToolbarState.showPrintMargin=this.printMarginState.showPrintMargin,this.lastToolbarState.showInvisibles=this.lastExpensiveState.showInvisibles,this.lastToolbarState.wordWrapEnabled=this.editor.getSession().getUseWrapMode(),this.toolbarState.canUndo=this.lastToolbarState.canUndo,this.toolbarState.canRedo=this.lastToolbarState.canRedo,this.toolbarState.showPrintMargin=this.lastToolbarState.showPrintMargin,this.toolbarState.showInvisibles=this.lastToolbarState.showInvisibles,this.toolbarState.wordWrapEnabled=this.lastToolbarState.wordWrapEnabled}catch(e){console.warn("Failed to initialize expensive state cache:",e),this.lastExpensiveState.showInvisibles=!1,this.lastExpensiveState.lastCheckTime=Date.now(),this.printMarginState.showPrintMargin=!0,this.printMarginState.printMarginColumn=80,this.printMarginState.lastUpdateTime=Date.now()}},performOptimizedUndo(){if(!(!this.editor||!this.editor.session))try{let e=this.editor.session.getUndoManager();if(!e||!e.hasUndo())return;let t=performance.now();if(t-this.undoRedoState.lastOperationTime<50&&this.undoRedoState.isProcessingQueue){this.undoRedoState.operationQueue.push({type:"undo",timestamp:t});return}this.undoRedoState.lastOperationTime=t,this.undoRedoState.isProcessingQueue=!0,requestAnimationFrame(()=>{try{this.editor.undo(),this.undoRedoState.lastCheckTime=0,this.updateToolbarState(!0),this.processUndoRedoQueue()}catch(s){console.warn("Undo operation failed:",s)}finally{this.undoRedoState.isProcessingQueue=!1}})}catch(e){console.warn("Undo operation failed:",e);try{this.editor.undo(),this.updateToolbarState(!0)}catch(t){console.warn("Fallback undo also failed:",t)}}},performOptimizedRedo(){if(!(!this.editor||!this.editor.session))try{let e=this.editor.session.getUndoManager();if(!e||!e.hasRedo())return;let t=performance.now();if(t-this.undoRedoState.lastOperationTime<50&&this.undoRedoState.isProcessingQueue){this.undoRedoState.operationQueue.push({type:"redo",timestamp:t});return}this.undoRedoState.lastOperationTime=t,this.undoRedoState.isProcessingQueue=!0,requestAnimationFrame(()=>{try{this.editor.redo(),this.undoRedoState.lastCheckTime=0,this.updateToolbarState(!0),this.processUndoRedoQueue()}catch(s){console.warn("Redo operation failed:",s)}finally{this.undoRedoState.isProcessingQueue=!1}})}catch(e){console.warn("Redo operation failed:",e);try{this.editor.redo(),this.updateToolbarState(!0)}catch(t){console.warn("Fallback redo also failed:",t)}}},processUndoRedoQueue(){if(this.undoRedoState.operationQueue.length===0)return;let e=this.undoRedoState.operationQueue,t=e.filter(s=>s.type==="undo").pop(),o=e.filter(s=>s.type==="redo").pop();this.undoRedoState.operationQueue=[],setTimeout(()=>{t&&this.canPerformUndo()?this.performOptimizedUndo():o&&this.canPerformRedo()&&this.performOptimizedRedo()},100)},canPerformUndo(){let e=Date.now();if(e-this.undoRedoState.lastCheckTime<this.undoRedoState.checkCacheTimeout)return this.undoRedoState.canUndo;try{let o=this.editor.session.getUndoManager(),s=o?o.hasUndo():!1;return this.undoRedoState.canUndo=s,this.undoRedoState.lastCheckTime=e,s}catch{return!1}},canPerformRedo(){let e=Date.now();if(e-this.undoRedoState.lastCheckTime<this.undoRedoState.checkCacheTimeout)return this.undoRedoState.canRedo;try{let o=this.editor.session.getUndoManager(),s=o?o.hasRedo():!1;return this.undoRedoState.canRedo=s,this.undoRedoState.lastCheckTime=e,s}catch{return!1}},optimizeUndoManager(){if(!(!this.editor||!this.editor.session))try{let e=this.editor.session.getUndoManager();if(!e)return;e.$undoDepth===1/0&&(e.$undoDepth=200),this.editor.session.mergeUndoDeltas!==!0&&(this.editor.session.mergeUndoDeltas=!0),this.undoRedoState.undoDepth=e.$undoStack?e.$undoStack.length:0,this.undoRedoState.redoDepth=e.$redoStack?e.$redoStack.length:0}catch(e){console.warn("Failed to optimize undo manager:",e)}},startBatchOperation(e="default"){let t=this.operationState;return t.isBatching||(t.isBatching=!0,t.currentOperation={type:e,startTime:performance.now(),changes:{...t.pendingChanges}},t.batchTimeout&&clearTimeout(t.batchTimeout)),t.currentOperation},endBatchOperation(){let e=this.operationState;if(!e.isBatching)return;if(!e.currentOperation){e.isBatching=!1;return}this.scheduleRenderFlush(),e.isBatching=!1,e.currentOperation=null},scheduleRenderFlush(){let e=this.operationState;e.batchTimeout||(e.batchTimeout=setTimeout(()=>{this.flushRenderChanges(),e.batchTimeout=null},e.batchDelay))},flushRenderChanges(){let e=this.operationState,t=e.pendingChanges,o=performance.now();if(o-e.lastRenderTime<16){this.scheduleRenderFlush();return}try{let s=0;t.cursor&&(s|=1),t.selection&&(s|=2),t.gutter&&(s|=4),t.scroll&&(s|=8),t.text&&(s|=16),(t.cursor||t.selection)&&(s|=32),this.editor&&this.editor.renderer&&this.editor.renderer.$loop&&this.editor.renderer.$loop.schedule(s),e.pendingChanges={cursor:!1,selection:!1,text:!1,scroll:!1,gutter:!1},e.lastRenderTime=o,e.renderChanges++}catch(s){console.warn("Render flush failed:",s)}},markChangePending(e){let t=this.operationState;t.pendingChanges.hasOwnProperty(e)&&(t.pendingChanges[e]=!0,t.isBatching||(this.startBatchOperation("auto"),setTimeout(()=>{t.isBatching&&t.currentOperation?.type==="auto"&&this.endBatchOperation()},0)))},setupPerformanceOptimizations(){if(this.editor)try{if(this.editor.session){this.optimizeUndoManager(),this.editor.session.setOption("mergeUndoDeltas","after");let e=this.editor.session.getUndoManager();e&&e.$undoDepth===1/0&&(e.$undoDepth=200)}this.editor.renderer&&(this.editor.renderer.setAnimatedScroll(!0),this.editor.renderer.$optimizeFontRendering=!0),console.debug("ACE performance optimizations enabled")}catch(e){console.warn("Failed to setup performance optimizations:",e)}},setupReliabilityImprovements(){if(this.editor)try{this.setupErrorBoundaries(),this.setupPerformanceMonitoring(),this.setupGracefulDegradation(),console.debug("ACE reliability improvements enabled")}catch(e){console.warn("Failed to setup reliability improvements:",e)}},setupErrorBoundaries(){let e=this.editor.setTheme.bind(this.editor);this.editor.setTheme=(...o)=>{try{return e(...o)}catch(s){return console.warn("Theme setting failed, using fallback:",s),e("ace/theme/textmate")}};let t=this.editor.setOptions.bind(this.editor);if(this.editor.setOptions=(...o)=>{try{return t(...o)}catch(s){return console.warn("Options setting failed, using defaults:",s),t({})}},this.editor.session){let o=this.editor.session.setValue.bind(this.editor.session);this.editor.session.setValue=(...s)=>{try{return o(...s)}catch(i){return console.warn("Session setValue failed:",i),o("")}}}},setupPerformanceMonitoring(){let e=0,t=0,o=this.editor.execCommand.bind(this.editor);this.editor.execCommand=(...s)=>{let i=performance.now();e++;try{let n=o(...s),a=performance.now()-i;return a>100&&(t++,console.debug(`Slow operation detected: ${s[0]} (${a.toFixed(2)}ms)`)),n}catch(n){return console.warn(`Command execution failed: ${s[0]}`,n),!1}},setInterval(()=>{if(e>0){let s=(t/e*100).toFixed(1);console.debug(`Performance: ${e} operations, ${s}% slow`),e=0,t=0}},3e4)},setupGracefulDegradation(){Object.entries({animatedScroll:()=>{try{return this.editor.setOption("animatedScroll",!0),this.editor.getOption("animatedScroll")}catch{return this.editor.setOption("animatedScroll",!1),!1}},liveAutocompletion:()=>{try{return this.editor.setOption("enableLiveAutocompletion",!0),this.editor.getOption("enableLiveAutocompletion")}catch{return this.editor.setOption("enableLiveAutocompletion",!1),!1}}}).forEach(([t,o])=>{try{let s=o();console.debug(`Feature ${t}: ${s?"enabled":"disabled (fallback)"}`)}catch(s){console.warn(`Feature test failed for ${t}:`,s)}})},performHealthCheck(){if(!this.editor)return{status:"error",message:"Editor not initialized"};try{let e={status:"healthy",checks:{}};e.checks.session=!!this.editor.session,e.checks.renderer=!!this.editor.renderer,e.checks.theme=!!this.editor.getTheme(),e.checks.mode=!!this.editor.session.getMode(),e.checks.document=!!this.editor.session.getDocument();let t=performance.now();this.editor.renderer.onResize(!1,!0),e.checks.responsive=performance.now()-t<50;let o=Object.values(e.checks).filter(s=>!s).length;return o>0&&(e.status="warning",e.message=`${o} health checks failed`),e}catch(e){return{status:"error",message:`Health check failed: ${e.message}`,error:e}}},attemptAutoRecovery(){try{return this.performHealthCheck().status==="error"?(console.warn("Attempting ACE editor auto-recovery..."),this.editor.session||(console.warn("Recreating session..."),this.editor.setSession(new ace.EditSession(""))),this.editor.getTheme()||(console.warn("Resetting theme..."),this.editor.setTheme("ace/theme/textmate")),this.editor.session.getMode()||(console.warn("Resetting mode..."),this.editor.session.setMode("ace/mode/text")),this.performHealthCheck().status!=="error"?(console.log("ACE editor auto-recovery successful"),!0):(console.error("ACE editor auto-recovery failed"),!1)):!0}catch(e){return console.error("Auto-recovery failed:",e),!1}},getButtonTitle(e){if(!this.hasToolbar||!e)return"";if(e==="toggle-fold"){let o=this.getEfficientFoldState();return o.isInsideFold||o.canUnfold?"Unfold Code (Ctrl+Alt+F)":o.canFold?"Fold Code (Ctrl+Alt+F)":"Fold/Unfold Code"}return{undo:"Undo (Ctrl+Z)",redo:"Redo (Ctrl+Y)",find:"Find (Ctrl+F)",replace:"Replace (Ctrl+H)","goto-line":"Go To Line (Ctrl+G)","toggle-comment":"Toggle Comment (Ctrl+/)","show-invisibles":"Show Invisible Characters","toggle-wordwrap":"Toggle Word Wrap","convert-uppercase":"Convert to Uppercase","convert-lowercase":"Convert to Lowercase","toggle-print-margin":"Toggle Print Margin"}[e]||e},getButtonDisabled(e){if(!this.editor)return!0;switch(e){case"undo":return!this.toolbarState.canUndo;case"redo":return!this.toolbarState.canRedo;default:return!1}},getButtonActiveState(e){if(!this.editor)return!1;switch(e){case"toggle-print-margin":return this.toolbarState.showPrintMargin;case"show-invisibles":return this.toolbarState.showInvisibles;case"toggle-wordwrap":return this.toolbarState.wordWrapEnabled;case"toggle-fold":let t=this.getEfficientFoldState();return t.canFold||t.canUnfold||t.isInsideFold;default:return!1}},getEfficientFoldState(){if(!this.editor||!this.editor.session)return{canFold:!1,canUnfold:!1,isInsideFold:!1};let e=this.editor.session,t=this.editor.getCursorPosition();if(this.lastFoldState.cursorRow===t.row&&this.lastFoldState.cursorColumn===t.column)return{canFold:this.lastFoldState.canFold,canUnfold:this.lastFoldState.canUnfold,isInsideFold:this.lastFoldState.isInsideFold};let o=!1,s=!1,i=!1;try{let n=e.isRowFolded(t.row),a=e.getFoldAt(t.row,t.column,1),l=e.getFoldWidget(t.row);i=n||!!a,l==="start"&&!n&&e.getFoldWidgetRange(t.row,"all")&&(o=!0),(n||a||l==="start"&&n)&&(s=!0),l==="end"&&n&&(s=!0)}catch(n){return console.warn("Fold state detection error:",n),{canFold:!1,canUnfold:!1,isInsideFold:!1}}return this.lastFoldState={canFold:o,canUnfold:s,isInsideFold:i,cursorRow:t.row,cursorColumn:t.column},{canFold:o,canUnfold:s,isInsideFold:i}},updateToolbarState(e=!1){if(!this.editor||!this.hasToolbar)return;this.debounceTimers.toolbarUpdate&&clearTimeout(this.debounceTimers.toolbarUpdate);let t=e?10:30;this.debounceTimers.toolbarUpdate=setTimeout(()=>{if(this.isDestroyed||!this.editor)return;let o=this.canPerformUndo(),s=this.canPerformRedo(),i=this.printMarginState.showPrintMargin,n=this.editor.getSession().getUseWrapMode(),a,l=Date.now(),r=l-this.lastExpensiveState.lastCheckTime;e||r>500?(a=this.editor.getShowInvisibles(),this.lastExpensiveState.showInvisibles=a,this.lastExpensiveState.lastCheckTime=l):a=this.lastExpensiveState.showInvisibles,this.lastFoldState.cursorRow=-1,this.lastFoldState.cursorColumn=-1,(e||r>100)&&this.updateFoldButtonState(),(this.lastToolbarState.canUndo!==o||this.lastToolbarState.canRedo!==s||this.lastToolbarState.showPrintMargin!==i||this.lastToolbarState.showInvisibles!==a||this.lastToolbarState.wordWrapEnabled!==n)&&(this.lastToolbarState.canUndo=o,this.lastToolbarState.canRedo=s,this.lastToolbarState.showPrintMargin=i,this.lastToolbarState.showInvisibles=a,this.lastToolbarState.wordWrapEnabled=n,this.toolbarState.canUndo=o,this.toolbarState.canRedo=s,this.toolbarState.showPrintMargin=i,this.toolbarState.showInvisibles=a,this.toolbarState.wordWrapEnabled=n)},t)},updateFoldButtonState(){if(this.editor)try{let e=this.$el.querySelector('[data-button="toggle-fold"]');if(!e)return;let t=this.getEfficientFoldState();t.isInsideFold||t.canUnfold?e.classList.add("fold-state-unfold"):e.classList.remove("fold-state-unfold")}catch{}},handleKeyboardShortcuts(){let e=this.editor;e.commands.addCommand({name:"toggleFullscreen",bindKey:{win:"Ctrl-F11",mac:"Cmd-F11"},exec:()=>this.toggleFullscreen()}),e.commands.addCommand({name:"toggleFullscreenAlt",bindKey:{win:"Ctrl-Shift-F",mac:"Cmd-Shift-F"},exec:()=>this.toggleFullscreen()}),e.commands.addCommand({name:"exitFullscreen",bindKey:{win:"Esc",mac:"Esc"},exec:()=>{this.isFullscreen&&this.toggleFullscreen()}})},addGlobalFullscreenEscapeHandler(){this._globalEscapeHandler=e=>{e.key==="Escape"&&this.isFullscreen&&(e.preventDefault(),e.stopPropagation(),this.toggleFullscreen())},document.addEventListener("keydown",this._globalEscapeHandler,!0)},initToolbar(){this.hasToolbar&&(this.handleKeyboardShortcuts(),this.updateToolbarState(),this.editor.selection.on("changeCursor",()=>{this.updateToolbarState()}),this.editor.session.on("change",()=>{this.updateToolbarState()}),this.editor.session.on("changeFold",()=>{this.lastFoldState.cursorRow=-1,this.lastFoldState.cursorColumn=-1,this.updateToolbarState()}),this.editor.on("focus",()=>{this.updateToolbarState()}),this.editor.on("blur",()=>{this.updateToolbarState()}))},initStatusBar(){this.editor&&(this.createStatusBar(),this.updateStatusBar(),this.editor.session.on("change",()=>this.updateStatusBar()),this.editor.selection.on("changeCursor",()=>this.updateStatusBar()),this.editor.session.on("changeMode",()=>this.updateStatusBar()))},createStatusBar(){let e=this.$el.querySelector(".rd-ace-editor-status");if(!e){e=document.createElement("div"),e.className="rd-ace-editor-status";let i=this.$el.closest(".rd-ace-editor");i&&i.appendChild(e)}this.statusBarElement=e,this.statusBarOptions.className&&(e.className=`rd-ace-editor-status ${this.statusBarOptions.className}`);let o={...{position:{show:!0,content:`<div class="rd-ace-editor-status-position">
                        <span>Line: <span class="line">1</span>, Col: <span class="column">1</span></span>
                        <span class="selection"></span>
                    </div>`},info:{show:!0,content:`<div class="rd-ace-editor-status-info">
                        <span class="mode">TEXT</span> |
                        <span class="length">0 chars</span>
                    </div>`}},...this.statusBarOptions.sections},s="";Object.entries(o).forEach(([i,n])=>{n.show!==!1&&(s+=n.content||"")}),e.innerHTML=s},updateStatusBar(){!this.editor||!this.statusBarElement||(this.debounceTimers.statusBarUpdate&&clearTimeout(this.debounceTimers.statusBarUpdate),this.debounceTimers.statusBarUpdate=setTimeout(()=>{if(this.isDestroyed||!this.statusBarElement)return;let e=this.editor.getCursorPosition(),t=this.editor.getSelection(),o=this.editor.getSession();this.statusBarElements.line||(this.statusBarElements.line=this.statusBarElement.querySelector(".line"),this.statusBarElements.column=this.statusBarElement.querySelector(".column"),this.statusBarElements.selection=this.statusBarElement.querySelector(".selection"),this.statusBarElements.mode=this.statusBarElement.querySelector(".mode"),this.statusBarElements.length=this.statusBarElement.querySelector(".length"));let s=e.row+1,i=e.column+1;this.statusBarElements.line&&this.statusBarElements.line.textContent!=s&&(this.statusBarElements.line.textContent=s),this.statusBarElements.column&&this.statusBarElements.column.textContent!=i&&(this.statusBarElements.column.textContent=i);let n=this.statusBarElements.selection;if(n){let r="";if(!t.isEmpty()){let d=t.getAllRanges().length;r=` (${d} line${d>1?"s":""} selected)`}n.textContent!==r&&(n.textContent=r)}let a=this.statusBarElements.mode;if(a){let d=(o.getMode().$id||"text").replace("ace/mode/","").toUpperCase();a.textContent!==d&&(a.textContent=d)}let l=this.statusBarElements.length;if(l){let r=o.getLength();if(this.statusBarState.lines!==r){let d=o.getValue().length;l.textContent=`${r} lines, ${d} chars`,this.statusBarState.lines=r}}},50))},destroyStatusBar(){this.statusBarElement&&this.statusBarElement.parentNode&&(this.statusBarElement.parentNode.removeChild(this.statusBarElement),this.statusBarElement=null)},initAccessibility(){this.editor&&(this.keyboardAccessibility&&this.initKeyboardAccessibility(),this.screenReaderSupport&&this.initScreenReaderSupport(),this.ariaLabels&&Object.keys(this.ariaLabels).length>0&&this.applyAriaLabels())},initKeyboardAccessibility(){let e=this.editor;e.commands.addCommand({name:"gotoLine",bindKey:{win:"Ctrl+G",mac:"Cmd+G"},exec:()=>{this.goToLine()}}),e.commands.addCommand({name:"gotoLineStart",bindKey:{win:"Home",mac:"Home|Ctrl+A"},exec:()=>{let t=e.getCursorPosition();e.moveCursorTo(t.row,0),e.clearSelection()}}),e.commands.addCommand({name:"gotoLineEnd",bindKey:{win:"End",mac:"End|Ctrl+E"},exec:()=>{let t=e.getCursorPosition(),o=e.session.getLine(t.row);e.moveCursorTo(t.row,o.length),e.clearSelection()}}),e.commands.addCommand({name:"selectWord",bindKey:{win:"Ctrl+Shift+Right",mac:"Cmd+Shift+Right"},exec:()=>{e.selection.selectWordRight(),e.renderer.scrollCursorIntoView()}}),e.commands.addCommand({name:"selectWordLeft",bindKey:{win:"Ctrl+Shift+Left",mac:"Cmd+Shift+Left"},exec:()=>{e.selection.selectWordLeft(),e.renderer.scrollCursorIntoView()}}),e.on("focus",()=>{this.announceToScreenReader("Editor focused")}),e.on("blur",()=>{this.announceToScreenReader("Editor unfocused")})},initScreenReaderSupport(){let e=this.editor;e.selection.on("changeCursor",()=>{let t=e.getCursorPosition();this.announceToScreenReader(`Line ${t.row+1}, Column ${t.column+1}`)}),e.selection.on("changeSelection",()=>{let t=e.getSelection();if(t.isEmpty())this.announceToScreenReader("Selection cleared");else{let o=e.session.getTextRange(t.getRange());this.announceToScreenReader(`Selected: ${o.length} characters`)}}),e.session.on("changeMode",()=>{let t=e.session.getMode().$id||"text";this.announceToScreenReader(`Mode changed to: ${t.replace("ace/mode/","").toUpperCase()}`)}),e.on("changeTheme",()=>{let t=e.getTheme()||"textmate";this.announceToScreenReader(`Theme changed to: ${t.replace("ace/theme/","").replace(/_/g," ")}`)})},applyAriaLabels(){let e=this.$el.querySelector(".ace_editor");if(!e)return;Object.entries(this.ariaLabels).forEach(([o,s])=>{let i=this.$el.querySelector(o)||e;i&&(i.setAttribute("aria-label",s),i.setAttribute("role",i.getAttribute("role")||"region"))}),e.setAttribute("role","application"),e.setAttribute("aria-label",this.ariaLabels.editor||"Code editor"),e.setAttribute("aria-multiline","true");let t=this.$el.querySelector(".ace_text-input");t&&(t.setAttribute("aria-label",this.ariaLabels.textarea||"Code input area"),t.setAttribute("aria-describedby","ace-editor-status"))},announceToScreenReader(e){if(!this.screenReaderSupport)return;let t=document.getElementById("ace-screen-reader-announcer");t||(t=document.createElement("div"),t.id="ace-screen-reader-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.style.position="absolute",t.style.left="-10000px",t.style.width="1px",t.style.height="1px",t.style.overflow="hidden",document.body.appendChild(t)),t.textContent=e,setTimeout(()=>{t.textContent=""},100)},changeFontSize(e){!this.editor||!e||(this.currentFontSize=e,this.editor.setOptions({fontSize:e}),this.editor.resize())},changeWordWrap(e){if(!this.editor||!e)return;this.currentWordWrap=e;let t=this.editor.getSession();switch(e){case"off":t.setUseWrapMode(!1);break;case"soft":t.setUseWrapMode(!0),t.setWrapLimitRange(null,null);break;case"hard":t.setUseWrapMode(!0),t.setWrapLimitRange(80,80);break;default:t.setUseWrapMode(!1);break}this.editor.resize()},applyOverscrollSettings(){if(!this.editor||!this.overscrollOptions)return;let t={...{enabled:!0,size:50,behavior:"auto",horizontal:!0,vertical:!0},...this.overscrollOptions};if(!t.enabled){this.editor.renderer.setScrollMargin(0,0,0,0);return}let o=t.vertical?t.size:0,s=t.horizontal?t.size:0,i=t.vertical?t.size:0,n=t.horizontal?t.size:0;this.editor.renderer.setScrollMargin(o,s,i,n),t.behavior==="manual"&&this.editor.session.on("changeScrollTop",()=>{});let a={};t.behavior!=="none"&&(a.autoScrollEditorIntoView=!0),this.editor.setOptions(a)}}}export{H as default};
